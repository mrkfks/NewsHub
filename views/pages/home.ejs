<div class="container my-5">
    <!-- Hero Carousel Section -->
    <div id="heroCarousel" class="carousel slide mb-5 shadow-lg rounded" data-bs-ride="carousel" data-bs-interval="4000">
        <div class="carousel-indicators" id="carouselIndicators">
            <!-- JavaScript ile doldurulacak -->
        </div>
        
        <div class="carousel-inner rounded" id="carouselInner" style="height: 500px;">
            <!-- Loading -->
            <div class="carousel-item active">
                <div class="d-flex align-items-center justify-content-center h-100 bg-gradient" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <div class="text-center text-white">
                        <div class="spinner-border mb-3" role="status">
                            <span class="visually-hidden">Yükleniyor...</span>
                        </div>
                        <h4>Haberler yükleniyor...</h4>
                    </div>
                </div>
            </div>
        </div>
        
        <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Önceki</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Sonraki</span>
        </button>
    </div>
    
    <!-- Category Tabs -->
    <div class="mb-4">
        <ul class="nav nav-pills justify-content-center flex-wrap" id="categoryTabs">
            <li class="nav-item">
                <button class="nav-link active" data-category="all">
                    <i class="fas fa-globe"></i> Tümü
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link" data-category="Teknoloji">
                    <i class="fas fa-laptop-code"></i> Teknoloji
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link" data-category="Spor">
                    <i class="fas fa-futbol"></i> Spor
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link" data-category="Ekonomi">
                    <i class="fas fa-chart-line"></i> Ekonomi
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link" data-category="Sağlık">
                    <i class="fas fa-heartbeat"></i> Sağlık
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link" data-category="Eğitim">
                    <i class="fas fa-graduation-cap"></i> Eğitim
                </button>
            </li>
        </ul>
    </div>
    
    <!-- News Grid -->
    <div class="row g-4" id="newsContainer">
        <div class="col-12 text-center" style="padding: 4rem 0;">
            <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
                <span class="visually-hidden">Yükleniyor...</span>
            </div>
            <p class="mt-3 text-muted">
                <i class="fas fa-newspaper"></i> Haberler yükleniyor...
            </p>
        </div>
    </div>
    
    <!-- Pagination -->
    <nav aria-label="Sayfa navigasyonu" class="mt-4">
        <ul class="pagination justify-content-center" id="pagination"></ul>
    </nav>
</div>

<% /* Script başlangıcı - express-ejs-layouts tarafından otomatik extract edilecek */ %>
<script>
(function() {
    'use strict';
    
    let currentCategory = 'all';
    let currentPage = 1;
    
    // Carousel için en son 10 haberi yükle
    async function loadLatestNewsForCarousel() {
        try {
            const response = await fetch('/api/news?page=1&limit=10&sort=-createdAt');
            const result = await response.json();
            
            if (result.success && result.data.news.length > 0) {
                displayCarousel(result.data.news);
            }
        } catch (error) {
            console.error('Carousel haberleri yüklenirken hata:', error);
        }
    }
    
    function displayCarousel(newsArray) {
        const carouselInner = document.getElementById('carouselInner');
        const carouselIndicators = document.getElementById('carouselIndicators');
        
        // Indicators oluştur
        carouselIndicators.innerHTML = newsArray.map((_, index) => `
            <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="${index}" 
                    ${index === 0 ? 'class="active" aria-current="true"' : ''} 
                    aria-label="Slide ${index + 1}"></button>
        `).join('');
        
        // Carousel items oluştur
        carouselInner.innerHTML = newsArray.map((news, index) => `
            <div class="carousel-item ${index === 0 ? 'active' : ''}">
                <div class="position-relative h-100">
                    <img src="${news.image || '/images/no-image.png'}" 
                         class="d-block w-100 h-100" 
                         style="object-fit: cover; filter: brightness(0.7);"
                         alt="${news.title}">
                    <div class="position-absolute bottom-0 start-0 w-100 p-4 text-white" 
                         style="background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, transparent 100%);">
                        <span class="badge bg-danger mb-2">${news.category}</span>
                        <h2 class="display-6 fw-bold mb-2">${news.title}</h2>
                        <p class="lead mb-3">${news.content.substring(0, 150)}...</p>
                        <div class="d-flex gap-3 align-items-center mb-3">
                            <small><i class="fas fa-eye"></i> ${news.views || 0} görüntülenme</small>
                            <small><i class="fas fa-calendar"></i> ${new Date(news.createdAt).toLocaleDateString('tr-TR')}</small>
                        </div>
                        <a href="/news/${news._id}" class="btn btn-light btn-lg">
                            <i class="fas fa-book-open"></i> Haberi Oku
                        </a>
                    </div>
                </div>
            </div>
        `).join('');
    }
    
    document.addEventListener('DOMContentLoaded', () => {
        loadLatestNewsForCarousel();
        loadNews(currentCategory, currentPage);
        
        // Kategori butonları
        document.querySelectorAll('#categoryTabs .nav-link').forEach(btn => {
            btn.addEventListener('click', (e) => {
                document.querySelectorAll('#categoryTabs .nav-link').forEach(b => b.classList.remove('active'));
                e.target.classList.add('active');
                currentCategory = e.target.dataset.category;
                currentPage = 1;
                loadNews(currentCategory, currentPage);
            });
        });
    });
    
    async function loadNews(category, page) {
        try {
            const url = category === 'all' 
                ? `/api/news?page=${page}&limit=12`
                : `/api/news?category=${category}&page=${page}&limit=12`;
            
            const response = await fetch(url);
            const result = await response.json();
            
            if (result.success) {
                displayNews(result.data.news);
                displayPagination(result.data.pagination);
            }
        } catch (error) {
            console.error('Haber yükleme hatası:', error);
            document.getElementById('newsContainer').innerHTML = 
                '<div class="col-12"><div class="alert alert-danger">Haberler yüklenirken hata oluştu.</div></div>';
        }
    }
    
    function displayNews(newsArray) {
        const container = document.getElementById('newsContainer');
        
        if (newsArray.length === 0) {
            container.innerHTML = `
                <div class="col-12">
                    <div class="alert alert-info glass-effect" style="border-radius: 20px; padding: 2rem;">
                        <i class="fas fa-info-circle fa-2x mb-3"></i>
                        <h4>Henüz Haber Bulunmuyor</h4>
                        <p>Bu kategoride henüz haber yok. Lütfen başka bir kategori deneyin.</p>
                    </div>
                </div>
            `;
            return;
        }
        
        // Kategori renklerini belirle
        const categoryColors = {
            'Teknoloji': 'bg-primary',
            'Spor': 'bg-success',
            'Ekonomi': 'bg-warning',
            'Sağlık': 'bg-danger',
            'Eğitim': 'bg-info',
            'Gündem': 'bg-secondary',
            'Diğer': 'bg-dark'
        };
        
        container.innerHTML = newsArray.map((news, index) => `
            <div class="col-md-4" style="animation: fadeInUp 0.6s ease ${index * 0.1}s both;">
                <div class="card h-100 shadow-sm">
                    <div style="overflow: hidden; border-radius: 20px 20px 0 0;">
                        <img src="${news.image || '/images/no-image.png'}" class="card-img-top" alt="${news.title}">
                    </div>
                    <div class="card-body">
                        <span class="badge ${categoryColors[news.category] || 'bg-primary'} mb-2">
                            ${news.category}
                        </span>
                        <h5 class="card-title">${news.title}</h5>
                        <p class="card-text text-muted" style="font-size: 0.95rem;">
                            ${news.content.substring(0, 120)}...
                        </p>
                        <div class="d-flex justify-content-between align-items-center text-muted small mt-3">
                            <span><i class="fas fa-eye"></i> ${news.views || 0}</span>
                            <span><i class="fas fa-calendar-alt"></i> ${new Date(news.createdAt).toLocaleDateString('tr-TR')}</span>
                        </div>
                    </div>
                    <div class="card-footer bg-transparent border-0 pb-3">
                        <a href="/news/${news._id}" class="btn btn-sm btn-outline-primary w-100">
                            <i class="fas fa-book-open"></i> Devamını Oku
                        </a>
                    </div>
                </div>
            </div>
        `).join('');
    }
    
    // Animasyon için CSS ekle
    const style = document.createElement('style');
    style.textContent = `
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    `;
    document.head.appendChild(style);
    
    function displayPagination(pagination) {
        const container = document.getElementById('pagination');
        if (!pagination || pagination.pages <= 1) {
            container.innerHTML = '';
            return;
        }
        
        let html = '';
        
        // Önceki butonu
        if (pagination.page > 1) {
            html += `<li class="page-item">
                <a class="page-link" href="#" data-page="${pagination.page - 1}">
                    <i class="fas fa-chevron-left"></i>
                </a>
            </li>`;
        }
        
        // Sayfa numaraları
        for (let i = 1; i <= pagination.pages; i++) {
            if (i === 1 || i === pagination.pages || (i >= pagination.page - 2 && i <= pagination.page + 2)) {
                html += `<li class="page-item ${i === pagination.page ? 'active' : ''}">
                    <a class="page-link" href="#" data-page="${i}">${i}</a>
                </li>`;
            } else if (i === pagination.page - 3 || i === pagination.page + 3) {
                html += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
            }
        }
        
        // Sonraki butonu
        if (pagination.page < pagination.pages) {
            html += `<li class="page-item">
                <a class="page-link" href="#" data-page="${pagination.page + 1}">
                    <i class="fas fa-chevron-right"></i>
                </a>
            </li>`;
        }
        
        container.innerHTML = html;
        
        // Event listener'ları ekle
        container.querySelectorAll('a.page-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const page = parseInt(e.currentTarget.dataset.page);
                if (page) changePage(page);
            });
        });
    }
    
    function changePage(page) {
        currentPage = page;
        loadNews(currentCategory, currentPage);
        window.scrollTo(0, 0);
    }
})(); // IIFE sonu
</script>
